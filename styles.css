:root {
  --bg-start: #f7e8f0;
  --bg-end: #e7f6ff;
  --text: #2b2b2b;
  --muted: #6a6a6a;
  --accent: #6b5b95;
  --card: #ffffffcc;
  --shadow: 0 10px 30px rgba(0,0,0,.12);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: "Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text);
  /* Layered background: image + subtle gradient fallback */
  background:
    linear-gradient(135deg, var(--bg-start), var(--bg-end)),
    url('./assets/pastel-bg.png');
  background-size: cover, cover;
  background-position: center, center;
  background-repeat: no-repeat, no-repeat;
}

#app { min-height: 100%; display: flex; flex-direction: column; }
.header { text-align: center; padding: 24px 16px 8px; }
.header h1 { margin: 0; font-weight: 800; letter-spacing: .2px; }
.subtitle { margin: 6px 0 0; color: var(--muted); }

.game { flex: 1; display: grid; grid-template-rows: auto 1fr; padding: 12px 16px 24px; gap: 16px; }

.grid {
  max-width: 980px;
  margin: 0 auto;
  width: 100%;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-auto-rows: 1fr;
  gap: 18px;
}

.egg {
  position: relative;
  aspect-ratio: 1 / 1.1;
  border-radius: 46% 46% 50% 50% / 55% 55% 45% 45%;
  background: radial-gradient(120% 90% at 50% 10%, rgba(255,255,255,.7), rgba(255,255,255,0) 55%), var(--egg-gradient, #f1c40f);
  box-shadow: 0 10px 20px rgba(0,0,0,.12), inset 0 4px 8px rgba(255,255,255,.35);
  cursor: pointer;
  transition: transform .18s ease, box-shadow .2s ease, filter .2s ease;
  overflow: hidden;
}

.egg:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 14px 26px rgba(0,0,0,.18), inset 0 5px 10px rgba(255,255,255,.4); }
.egg:active { transform: translateY(0) scale(.98); filter: brightness(.98); }

.egg-inner { position: absolute; inset: 0; }
.egg-top, .egg-bottom {
  position: absolute; left: 0; right: 0;
  background: inherit;
}
.egg-top { top: 0; height: 52%; border-bottom: 2px dashed rgba(0,0,0,.08); }
.egg-bottom { bottom: 0; height: 52%; border-top: 2px dashed rgba(0,0,0,.08); }

/* Decorative patterns */
.egg::after {
  content: "";
  position: absolute; inset: 10% 14% auto 14%; bottom: 12%;
  background: repeating-linear-gradient(45deg,rgba(255,255,255,.7) 0 6px,transparent 6px 12px);
  opacity: .35; border-radius: 12px; filter: blur(.2px);
}

/* Crack animation */
.egg.cracked .egg-top { animation: crackTop .6s ease forwards; }
.egg.cracked .egg-bottom { animation: crackBottom .6s ease forwards; }

@keyframes crackTop {
  0% { transform: translateY(0) rotate(0); }
  60% { transform: translate(-2px,-8px) rotate(-6deg); }
  100% { transform: translate(-6px,-26px) rotate(-12deg); opacity: .9; }
}
@keyframes crackBottom {
  0% { transform: translateY(0) rotate(0); }
  60% { transform: translate(2px,8px) rotate(6deg); }
  100% { transform: translate(8px,28px) rotate(14deg); opacity: .9; }
}

.burst-layer {
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  --burst-x: 50%;
  --burst-y: 50%;
  background:
    radial-gradient(closest-side at var(--burst-x) var(--burst-y), rgba(255,255,255,0.95), rgba(255,255,255,0.6) 40%, rgba(255,255,255,0) 70%),
    radial-gradient(900px 900px at var(--burst-x) var(--burst-y), rgba(255,215,0,0.28), rgba(255,215,0,0) 60%);
  mix-blend-mode: screen;
  transition: opacity .25s ease;
  z-index: 20;
}
.burst-layer.active { opacity: 1; animation: flash 700ms ease forwards; }

@keyframes flash {
  0% { opacity: 0; filter: blur(0px); }
  10% { opacity: 1; filter: blur(0px); }
  60% { opacity: .9; filter: blur(1px); }
  100% { opacity: 0; filter: blur(2px); }
}

.fortune-panel { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,.35); backdrop-filter: blur(2px); z-index: 30; }
.fortune-panel.hidden { display: none; }
.fortune-card {
  width: min(680px, 92vw);
  background: var(--card);
  backdrop-filter: blur(6px);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 24px 20px 18px;
  text-align: center;
  position: relative;
  transform: translateY(10px);
  opacity: 0;
  animation: panelIn 420ms ease forwards;
}
.fortune-text {
  font-family: "Shippori Antique B1", serif;
  font-size: clamp(18px, 2.6vw, 22px);
  line-height: 1.4;
  margin: 0 0 14px;
}
.fortune-ribbon {
  position: absolute; inset: -10px -10px auto -10px; height: 10px; border-radius: 16px 16px 0 0;
  background: linear-gradient(90deg, #ffd700, #ff9a9e, #a18cd1);
  background-size: 200% 100%; animation: ribbon 3s linear infinite;
}
@keyframes ribbon { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }

.actions { display: flex; gap: 10px; justify-content: center; }
.btn {
  appearance: none; border: none; border-radius: 10px; padding: 10px 14px; cursor: pointer;
  background: var(--accent); color: white; font-weight: 700; letter-spacing: .3px; box-shadow: 0 6px 14px rgba(0,0,0,.15);
}
.btn:hover { filter: brightness(1.05); }
.btn:active { transform: translateY(1px); }
.btn-outline { background: white; color: var(--accent); border: 2px solid var(--accent); }

.footer { display: grid; place-items: center; padding: 10px 0 24px; }
.sound-toggle { background: transparent; border: 2px dashed rgba(0,0,0,.25); border-radius: 999px; padding: 8px 12px; cursor: pointer; }
.sound-toggle[aria-pressed="true"] { background: rgba(0,0,0,.08); }

/* Golden fortune styles */
.egg.golden { position: relative; }
.egg.golden::before {
  content: ""; position: absolute; inset: -10%; border-radius: inherit;
  background: conic-gradient(from 0deg, #fff2 0 10%, #ffd70055 10% 30%, #fff2 30% 40%, #ffd70055 40% 60%, #fff2 60% 70%, #ffd70055 70% 90%, #fff2 90% 100%);
  mix-blend-mode: color-dodge; pointer-events: none; filter: blur(2px); opacity: .9;
}

.fortune-card.golden { border: 2px solid #ffd700; box-shadow: 0 16px 36px rgba(255,215,0,.35); }

@keyframes panelIn {
  from { transform: translateY(16px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Responsive */
@media (max-width: 920px) {
  .grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 640px) {
  .grid { grid-template-columns: repeat(2, 1fr); gap: 14px; }
  .header { padding-bottom: 0; }
}

/* Focus ring for keyboard/swipe selection */
.egg.is-focused { outline: 3px solid rgba(99,102,241,.9); outline-offset: 3px; }

